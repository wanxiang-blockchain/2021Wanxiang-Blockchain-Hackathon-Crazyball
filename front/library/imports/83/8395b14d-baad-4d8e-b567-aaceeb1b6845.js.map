{"version":3,"sources":["assets/src/game/item/BrickItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameModel from '../model/GameModel';\nimport { EventDispatch, Event_Name } from '../../common/event/EventDispatch';\nimport GameConst from '../GameConst';\nimport BallItem from './BallItem';\nimport { AudioPlayer } from '../../common/audio/AudioPlayer';\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class BrickItem extends cc.Component {\n  @property(cc.Label)\n  lb_hp: cc.Label = null;\n\n  @property(cc.Node)\n  icon: cc.Node = null;\n\n  @property(cc.Node)\n  icon_hp_reduce: cc.Node = null;\n\n  @property(cc.Node)\n  icon_power: cc.Node = null;\n\n  @property(cc.Integer)\n  brick_type: number = 0;\n\n  @property(cc.Integer)\n  star_num: number = 0;\n\n  @property(cc.Integer)\n  ball_num: number = 0;\n\n  @property(cc.Integer)\n  effect_type: number = 0;\n\n  @property(cc.Integer)\n  brick_radius_mul: number = 1;\n\n  private _hp = 1;\n  public set hp(hp) {\n    const lastHp = this._hp;\n    this._hp = hp;\n    if (hp <= 0) {\n      if (lastHp > 0) {\n        if (this.ball_num > 0) {\n          for (let index = 0; index < this.ball_num; index++) {\n            EventDispatch.ins().fire(Event_Name.GAME_CREATE_BALL);\n          }\n          AudioPlayer.ins().play_sound('balls');\n        }\n        if (this.star_num > 0) {\n          EventDispatch.ins().fire(Event_Name.GAME_STAR_GET_EFFECT, this.node.x, this.node.y, this.star_num);\n          GameModel.ins().ball_power += this.star_num;\n          AudioPlayer.ins().play_sound('star');\n        }\n        if (this.effect_type > 0) {\n          EventDispatch.ins().fire(Event_Name.GAME_POWER_TYPE_CHANGED, this.effect_type);\n        }\n        EventDispatch.ins().fire(Event_Name.GAME_PLAY_BRICK_REMOVE_EFFECT, this.node.x, this.node.y, this.icon_hp_reduce.color);\n      }\n      this.node.active = false;\n    } else {\n      this.lb_hp.string = `${hp > 1000000 ? Math.round(hp / 1000000) + 'M' : hp > 1000 ? Math.round(hp / 1000) + 'K' : hp}`;\n      const theme_config = GameConst.ins().theme_config[0];\n      if (theme_config) {\n        this.icon_hp_reduce.color = this.icon.color = theme_config.color[Math.ceil(hp / this._color_hp) - 1] || theme_config.color[0];\n      } else {\n        this.icon_hp_reduce.color = this.icon.color = cc.Color.WHITE;\n      }\n      if (hp < lastHp) {\n        if (this.icon_hp_reduce.getNumberOfRunningActions() <= 0) {\n          this.icon_hp_reduce.active = true;\n          this.icon_hp_reduce.opacity = 255;\n          this.icon_hp_reduce.runAction(\n            cc.sequence(\n              cc.blink(0.2, 1),\n              cc.callFunc(() => {\n                if (this.icon_hp_reduce) this.icon_hp_reduce.active = false;\n              })\n            )\n          );\n        }\n      }\n    }\n  }\n  public get hp() {\n    return this._hp;\n  }\n\n  private _color_hp = 1;\n\n  onLoad() {\n    if (this.icon_power) {\n      this.icon_power.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(1, 1.2, 1.2), cc.scaleTo(1, 1, 1))));\n    }\n  }\n\n  init(colors_num: number, hp: number) {\n    const theme_config = GameConst.ins().theme_config[0];\n    colors_num = colors_num > theme_config.color.length ? theme_config.color.length : colors_num;\n    colors_num = colors_num > 0 ? colors_num : 1;\n    this._color_hp = Math.ceil(hp / colors_num);\n    this._hp = hp;\n    this.hp = hp;\n\n    this.icon_hp_reduce.active = false;\n    this.icon_hp_reduce.stopAllActions();\n  }\n\n  reset() {\n    this.node.stopAllActions();\n    this.node.active = false;\n  }\n\n  update(dt) {\n    if (this.lb_hp.node.angle !== -this.node.angle) {\n      this.lb_hp.node.angle = -this.node.angle;\n    }\n  }\n\n  onEndContact(contact: cc.PhysicsContact, selfCollider: cc.PhysicsCollider, otherCollider: cc.PhysicsCollider) {\n    switch (otherCollider.tag) {\n      case 100: {\n        let ballItem = otherCollider.node.getComponent(BallItem);\n        if (ballItem && this.hp > 0) {\n          let power = GameModel.ins().ball_power * ballItem.power_scale;\n          power = power > this.hp ? this.hp : power;\n          this.hp -= power;\n          GameModel.ins().score += power;\n        }\n        break;\n      }\n    }\n  }\n}\n"]}