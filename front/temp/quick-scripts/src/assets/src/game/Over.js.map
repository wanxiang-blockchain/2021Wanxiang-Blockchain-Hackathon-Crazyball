{"version":3,"sources":["assets/src/game/Over.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { formatPrice } from './common/Common';\nimport GameModel from './model/GameModel';\nimport { AudioPlayer } from '../common/audio/AudioPlayer';\nimport { EventDispatch, Event_Name } from '../common/event/EventDispatch';\nimport State from './model/State';\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class Over extends cc.Component {\n  @property(cc.Node)\n  overBox: cc.Node = null;\n  @property(cc.Node)\n  mask: cc.Node = null;\n  @property(cc.Node)\n  loading: cc.Node = null;\n  @property(cc.Node)\n  fail: cc.Node = null;\n  @property(cc.Node)\n  win: cc.Node = null;\n  @property(cc.Label)\n  count: cc.Label = null;\n  @property(cc.Node)\n  countBox: cc.Node = null;\n  @property(cc.Label)\n  diff: cc.Label = null;\n  @property(cc.Label)\n  reliveCount: cc.Label = null;\n  @property(cc.Node)\n  reliveBox: cc.Node = null;\n  @property(cc.Node)\n  reloadBox: cc.Node = null;\n  @property(cc.Node)\n  goBack: cc.Node = null;\n  @property(cc.Node)\n  getMoneyBox: cc.Node = null;\n  @property(cc.Label)\n  getMoneyTitle: cc.Label = null;\n\n  onLoad() {\n    this.mask.on('touchstart', () => {}, this, true);\n  }\n\n  async onEnable() {\n    this.win.active = false;\n    this.fail.active = false;\n    this.countBox.active = false;\n    this.goBack.on('touchstart', this.onGoBack, this);\n\n    let count = GameModel.ins().score;\n    this.count.string = formatPrice(count, 0, false, ' ');\n    this.loading.active = true;\n    cc.tween(this.loading)\n      .repeatForever(cc.tween().by(0.3, { angle: 90 }))\n      .start();\n    this.loading.active = false;\n    this.countBox.active = true;\n    if (Number(count) > Number(State.ins().mainNear.maxScore)) {\n      State.ins().mainNear.contract.upload_score({ account_id: State.ins().mainNear.ownerKey, score: count });\n      this.win.active = true;\n      this.fail.active = false;\n      this.getMoneyTitle.string = `保持一天擂主后奖励自动发放`;\n      this.getMoneyBox.on('touchstart', this.onGoBack);\n      AudioPlayer.ins().play_sound('congra');\n    } else {\n      this.win.active = false;\n      this.fail.active = true;\n      this.reliveBox.once('touchstart', this.onReliveBox, this);\n      this.reloadBox.on('touchstart', this.onReloadBox, this);\n      this.diff.string = formatPrice(State.ins().mainNear.maxScore - count, 0, false, ' ');\n      let reliveObj = State.ins().imageList.find((item) => {\n        return item.type === 7;\n      });\n      this.reliveCount.string = 'x' + reliveObj.payCount.toString();\n      AudioPlayer.ins().play_sound('win');\n    }\n  }\n\n  private onGoBack() {\n    cc.director.loadScene('main');\n  }\n  private async onReliveBox() {\n    let findIndex = State.ins().imageList.findIndex((item, index) => {\n      return item.type === 7;\n    });\n    if (findIndex > -1) {\n      let tokenId = State.ins().imageList[findIndex].payList.splice(0, 1)[0].token_id;\n      State.ins().imageList[findIndex].payCount -= 1;\n      await State.ins().mainNear.contract.nft_burn({\n        token_id: tokenId\n      });\n      EventDispatch.ins().fire(Event_Name.GAME_RELIVE);\n    } else {\n    }\n  }\n  private async onReloadBox() {\n    localStorage.setItem('initScene', 'game');\n    State.ins().mainNear.contract.sign_up(\n      {\n        account_id: State.ins().mainNear.ownerKey\n      },\n      300000000000000,\n      window.nearApi.utils.format.parseNearAmount('1')\n    );\n  }\n}\n"]}