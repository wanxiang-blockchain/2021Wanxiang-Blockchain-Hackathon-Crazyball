{"version":3,"sources":["assets/src/game/StorePay.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { formatPrice } from './common/Common';\nimport State from './model/State';\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class StorePay extends cc.Component {\n  @property(cc.Node)\n  maskBox: cc.Node = null;\n  @property(cc.Node)\n  mask: cc.Node = null;\n  @property(cc.Node)\n  closeButton: cc.Node = null;\n  @property(cc.Sprite)\n  icon: cc.Sprite = null;\n  @property(cc.Label)\n  title: cc.Label = null;\n  @property(cc.Label)\n  price: cc.Label = null;\n  @property(cc.Node)\n  delButton: cc.Node = null;\n  @property(cc.Label)\n  count: cc.Label = null;\n  @property(cc.Node)\n  addButton: cc.Node = null;\n  @property(cc.Label)\n  totalPrice: cc.Label = null;\n  @property(cc.Node)\n  buyButton: cc.Node = null;\n\n  _count = 1;\n  _totalPrice = 0;\n  boxObj = null;\n\n  onLoad() {\n    this.closeButton.on('touchstart', this.onClose, this);\n    this.buyButton.on('touchstart', this.onBuy, this);\n    this.mask.on(\n      'touchstart',\n      (event) => {\n        event.stopPropagation();\n      },\n      this\n    );\n  }\n\n  setImage(target, url: string) {\n    cc.resources.load(url, cc.SpriteFrame, (err, spriteFrame: cc.SpriteFrame) => {\n      target.spriteFrame = spriteFrame;\n    });\n  }\n\n  initBox(obj) {\n    this.boxObj = obj;\n    this.maskBox.active = true;\n    this.setImage(this.icon, obj.url);\n    this.title.string = obj.title;\n    this.price.string = formatPrice(obj.price, 2, true) + ' Near';\n    this.watchCount();\n  }\n\n  private watchCount() {\n    this.count.string = this._count.toString();\n    this._totalPrice = this._count * Number(this.boxObj.price);\n    this.totalPrice.string = formatPrice(this._totalPrice, 2, true) + ' Near';\n  }\n\n  private onClose() {\n    this.maskBox.active = false;\n    var scene = cc.director.getScene();\n    scene.getChildByName('Canvas').removeChild(State.ins().storePayBox);\n  }\n\n  private async onBuy() {\n    State.ins().storeNear.contract.offer(\n      {\n        nft_contract_id: State.ins().storePayObj.nft_contract_id,\n        token_id: State.ins().storePayObj.token_id\n      },\n      300000000000000,\n      window.nearApi.utils.format.parseNearAmount(this._totalPrice.toString())\n    );\n  }\n}\n"]}